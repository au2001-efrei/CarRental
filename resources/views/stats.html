<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script>const customers = {{customers}}, agencies = {{agencies}}, turnovers = {{turnovers}};</script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html {
            font-family: Verdana, Tahoma, sans-serif;
            background: url('https://images.unsplash.com/photo-1586084786421-3c17ba0108a9?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1601&q=80');
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }
        
        header {
            max-width: 1000px;
            width: 100%;
            background: #fff;
            margin: 25px 0 25px 0;
            border-radius: 25px;
        }
        
        .width {
            width: 100%;
        }
        
        h1 {
            text-align: center;
            margin: 25px;
            color: #11d2f0;
        }
        
        body {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }
        
        main {
            width: 100%;
        }
        
        .head-form {
            max-width: 1000px;
            width: 100%;
            border-radius: 25px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.25);
        }
        
        .time {
            margin-top: 20px;
            width: 30%;
            height: 40px;
            text-align: center;
        }
        
        :disabled {
            opacity: .5;
        }
        
        .img {
            display: block;
            height: 100px;
            width: 100px;
            margin-left: auto;
            margin-right: auto;
            margin-top: 50px;
            border-radius: 100%;
            box-shadow: 6px 6px 20px rgba(0, 0, 0, 0.25);
        }
        
        input {
            background-color: #C4C4C4;
            border-radius: 20px;
            height: 40px;
            width: 200px;
            margin: 5px;
            padding: 10px;
            border: none;
            font-size: 12px;
            color: black;
            flex-grow: 1;
        }
        
        .time {
            flex-grow: 1;
            width: 60%;
        }
        
        ::placeholder {
            color: black;
        }
        
        .wrapper {
            height: 40px;
            width: 200px;
            margin: 5px;
            border-radius:20px;
            display:inline-block;
            overflow:hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-grow: 1;
        }
        
        select {
            background-color: #C4C4C4;
            border-radius: 20px;
            height: 100%;
            width: 100%;
            padding: 3px;
            border: none;
            outline: none;
        }
        
        textarea {
            vertical-align: top;
            height: 5em;
        }
        
        form {
            max-width: 1000px;
            margin: 10px;
            background-color: white;
            margin-right: auto;
            margin-left: auto;
            position: sticky;
            top: 10;
        }
        .flex {
            display: flex;
        }
        .fix {
            position: fixed;
            top: 0px;
            margin-left: 12%;
        }
        
        .table {
            max-width: 1000px;
        }
        
        #email:invalid,
        #first_name:invalid,
        #family_name:invalid {
            caret-color: red;
            border-bottom: 3px solid red;
        }
        
        /* main */
        
        .tableau {
            max-width: 1000px;
            width: 100%;
            background-color: white;
            border-radius: 25px;
            overflow:hidden;
            margin: 50px auto 50px auto;
        }
        
        th {
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: center;
            /* background-color: #4CAF50; */
            color: black;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #e9e9e9;
        }
        
        tr:last-child {
            background-color: white;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        td {
            text-align: center;
            padding-top: 12px;
            padding-bottom: 12px;
            padding: 8px;
            border-bottom: 1px solid black;
        }
        
        .not {
            background-color: crimson;
        }
        
        .not-not {
            background-color: lightgreen;
        }
        
        .third {
            width: 30%;
        }
        
        nav {
            width: 100vw;
            display:flex;
            background-color: #11d2f0;
            justify-content: space-around;
            padding:20px 0;
            color:#FFF;
            align-items: center;
        }
        
        ul {
            display:flex;
            list-style: none;
            width:40%;
            justify-content: space-between;
        }
        
        nav ul li a {
            color:#FFF;
            text-decoration: none;
            font-size: 1em;
        }
    </style>
    <title>Car Rental &mdash; Stats</title>
</head>
<body>
    <nav>
        <div class="logo">
            <h2>Car Rental</h2>
        </div>
        <ul>
            <li><a href="/customers">Customers</a></li>
            <li><a href="/rentals">Rentals</a></li>
            <li><a href="/vehicles">Cars</a></li>
            <li><a href="/stats">Stats</a></li>
            <li><a href="/logout">Logout</a></li>
        </ul>
    </nav>
    <header>
        <h1>Car Rental â€” Stats</h1>
    </header>
    <div class="width"></div>
    <header>
        <h1>Gold membership customers</h1>
    </header>
    <main>
        <table class="tableau">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Number of rentals</th>
                    <th>Money Spent</th>
                </tr>
            </thead>
            <tbody id="customers" class="color">
            </tbody>
        </table>
    </main>
    <header>
        <h1>Agencies over 80% capacity</h1>
    </header>
    <main>
        <table class="tableau">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Address</th>
                    <th>Current Capacity</th>
                </tr>
            </thead>
            <tbody id="agencies" class="color">
            </tbody>
        </table>
    </main>
    <header>
        <h1>Turnover per agency this year</h1>
    </header>
    <main>
        <table class="tableau">
            <thead>
                <tr>
                    <th>Agency</th>
                    <th>Number of rentals</th>
                    <th>Turnover</th>
                </tr>
            </thead>
            <tbody id="turnovers" class="color">
            </tbody>
        </table>
    </main>
    
    <script>
      const $customers = document.getElementById("customers");
      customers.forEach(customer => {
        const $row = document.createElement("tr");

        const $nameCell = document.createElement("td");
        const $link = document.createElement("a");
        $link.href = `/customer/${encodeURIComponent(customer.id)}`;
        $link.innerText = `${customer.first_name} ${customer.last_name}`;
        $nameCell.appendChild($link);
        $row.appendChild($nameCell);

        const $rentalsCell = document.createElement("td");
        $rentalsCell.innerText = customer.rentals_count;
        $row.appendChild($rentalsCell);

        const $moneyCell = document.createElement("td");
        $moneyCell.innerText = `$${customer.spending_sum}`;
        $row.appendChild($moneyCell);

        $customers.appendChild($row);
      });

      const $agencies = document.getElementById("agencies");
      agencies.forEach(agency => {
        const $row = document.createElement("tr");

        const $nameCell = document.createElement("td");
        const $link = document.createElement("a");
        $link.href = `/agency/${encodeURIComponent(agency.id)}`;
        $link.innerText = agency.name;
        $nameCell.appendChild($link);
        $row.appendChild($nameCell);

        const $addressCell = document.createElement("td");
        const address = [];
        if (agency.street_number !== null) address.push(agency.street_number);
        if (agency.street_name !== null) address.push(agency.street_name);
        if (agency.postal_code !== null) address.push(agency.postal_code);
        if (agency.city !== null) address.push(agency.city);
        if (address.length > 0)
          $addressCell.innerText = address.join(" ");
        else $addressCell.innerHTML = "<i>No address</i>";
        $row.appendChild($addressCell);

        const $capacityCell = document.createElement("td");
        $capacityCell.innerText = `${agency.vehicles_count} / ${agency.capacity}`;
        $row.appendChild($capacityCell);

        $agencies.appendChild($row);
      });

      const $turnovers = document.getElementById("turnovers");
      turnovers.forEach(agency => {
        const $row = document.createElement("tr");

        const $nameCell = document.createElement("td");
        const $link = document.createElement("a");
        $link.href = `/agency/${encodeURIComponent(agency.id)}`;
        $link.innerText = agency.name;
        $nameCell.appendChild($link);
        $row.appendChild($nameCell);

        const $rentalsCell = document.createElement("td");
        $rentalsCell.innerText = agency.rentals_count;
        $row.appendChild($rentalsCell);

        const $turnoverCell = document.createElement("td");
        $turnoverCell.innerText = `$${agency.spending_sum}`;
        $row.appendChild($turnoverCell);

        $turnovers.appendChild($row);
      });
    </script>
</body>
</html>
